{"version":3,"sources":["mongodbmodel.coffee"],"names":[],"mappings":"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","file":"mongodbmodel.js","sourceRoot":"/source/","sourcesContent":["BaseModel = require './basemodel'\nloadMongoModel = (require './baseinit').loadMongoModel\nclass MongodbModel extends BaseModel\n  constructor: (modelName, modelType) ->\n    super(modelName, modelType, loadMongoModel)\n  order: (order) ->\n    @params.order = order\n\n  findAll: () ->\n    self = @\n    @action = (callback) ->\n      self.Model.find()\n      .where(self.params.where)\n      .skip(self.params.offset)\n      .limit(self.params.limit)\n      .select( if self.params.fields  then self.params.fields.join(' ') else null )\n      .sort(self.params.order)\n      .then (data) ->\n        callback(null, data)\n      .catch (err) ->\n        callback(err)\n    @\n  findById: (id) ->\n    self = @\n    @action = (callback) ->\n      self.params.where = self.params.where || {}\n      self.params.where[_id] = id\n      self.Model.findOne(self.params.where, if self.params.fields then  self.params.fields.join(' ') else null)\n      .then (data) ->\n        callback(null, data)\n      .catch (err) ->\n        callback(err)\n    @\n  findByField: (field, value) ->\n    self = @\n    @action = (callback) ->\n      self.params.where = self.params.where || {}\n      self.params.where[field] = value\n      self.Model.findOne(self.params.where, if self.params.fields then self.params.fields.join(' ') else null)\n      .then (data) ->\n        callback(null, data)\n      .catch (err) ->\n        callback(err)\n    @\n  count: () ->\n    self = @\n    @action = (callback) ->\n      self.Model.count self.params.where\n      .then (count) ->\n        callback(null, count)\n      .catch (err) ->\n        callback(err)\n    @\n  add: (kv) ->\n    self = @\n    @action = (callback) ->\n      self.Model.create(kv)\n      .then (data) ->\n        callback(null, data)\n      .catch (err) ->\n        callback(err)\n    @\n  update: (kv) ->\n    self = @\n    @action = (callback) ->\n      if self.result\n        self.Model.update\n          _id: self.result._id\n          kv\n        .then () ->\n          callback(null)\n        .catch (err) ->\n          callback(err)\n      else\n        self.Model.update(self.params.where, kv)\n        .then () ->\n          callback(null)\n        .catch (err) ->\n          callback(err)\n      @\n  delete: () ->\n    self = @\n    @action = (callback) ->\n      if self.result\n        self.Model.remove\n          _id: self.result._id\n        .then (data) ->\n          callback(null, data)\n        .catch (err) ->\n          callback(err)\n      else\n        self.Model.remove self.params.where\n        .then () ->\n          callback()\n      @\n  addCount: (key) ->\n    self = @\n    @action = (callback) ->\n      if self.result\n        obj = {}\n        obj[key] = self.result[key] * 1 + 1\n        self.Model.update obj\n          _id: self.result._id\n        .then () ->\n          callback(null)\n        .catch (err) ->\n          callback(err)\n      else\n        callback(new Error('先调用findBy再调用addCount，please'))\n      @\n\n\nmodule.exports =\n  MongodbModel\n"]}