var BaseModel,MongodbModel,loadMongoModel,extend=function(t,n){function r(){this.constructor=t}for(var e in n)hasProp.call(n,e)&&(t[e]=n[e]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},hasProp={}.hasOwnProperty;BaseModel=require("./basemodel"),loadMongoModel=require("./baseinit").loadMongoModel,MongodbModel=function(t){function n(t,r){n.__super__.constructor.call(this,t,r,loadMongoModel)}return extend(n,t),n.prototype.order=function(t){return this.params.order=t},n.prototype.findAll=function(){var t;return t=this,this.action=function(n){return t.Model.find().where(t.params.where).skip(t.params.offset).limit(t.params.limit).select(t.params.fields?t.params.fields.join(" "):null).sort(t.params.order).then(function(t){return n(null,t)})["catch"](function(t){return n(t)})},this},n.prototype.findById=function(t){var n;return n=this,this.action=function(r){return n.params.where=n.params.where||{},n.params.where[_id]=t,n.Model.findOne(n.params.where,n.params.fields?n.params.fields.join(" "):null).then(function(t){return r(null,t)})["catch"](function(t){return r(t)})},this},n.prototype.findByField=function(t,n){var r;return r=this,this.action=function(e){return r.params.where=r.params.where||{},r.params.where[t]=n,r.Model.findOne(r.params.where,r.params.fields?r.params.fields.join(" "):null).then(function(t){return e(null,t)})["catch"](function(t){return e(t)})},this},n.prototype.count=function(){var t;return t=this,this.action=function(n){return t.Model.count(t.params.where).then(function(t){return n(null,t)})["catch"](function(t){return n(t)})},this},n.prototype.add=function(t){var n;return n=this,this.action=function(r){return n.Model.create(t).then(function(t){return r(null,t)})["catch"](function(t){return r(t)})},this},n.prototype.update=function(t){var n;return n=this,this.action=function(r){return n.result?n.Model.update({_id:n.result._id},t).then(function(){return r(null)})["catch"](function(t){return r(t)}):n.Model.update(n.params.where,t).then(function(){return r(null)})["catch"](function(t){return r(t)}),this}},n.prototype["delete"]=function(){var t;return t=this,this.action=function(n){return t.result?t.Model.remove({_id:t.result._id}).then(function(t){return n(null,t)})["catch"](function(t){return n(t)}):t.Model.remove(t.params.where).then(function(){return n()}),this}},n.prototype.addCount=function(t){var n;return n=this,this.action=function(r){var e;return n.result?(e={},e[t]=1*n.result[t]+1,n.Model.update(e({_id:n.result._id})).then(function(){return r(null)})["catch"](function(t){return r(t)})):r(new Error("先调用findBy再调用addCount，please")),this}},n}(BaseModel),module.exports=MongodbModel;